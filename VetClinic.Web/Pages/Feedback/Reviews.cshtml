@page "/feedback/reviews"
@model VetClinic.Web.Pages.Feedback.ReviewsModel
@{
    ViewData["Title"] = "Customer Reviews";
}

<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="text-center mb-5">
                <h2 class="display-5">
                    <i class="fas fa-star text-warning"></i>
                    What Our Customers Say
                </h2>
                <p class="lead text-muted">Read reviews from pet owners who have visited our clinic</p>
            </div>
        </div>
    </div>

    @if (Model.ApprovedFeedback?.Any() == true)
    {
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="card h-100 shadow-sm border-0">
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <h4 class="text-primary">
                                <i class="fas fa-chart-line"></i>
                                Overall Rating
                            </h4>
                            <div class="display-4 text-warning">
                                @Model.AverageRating.ToString("F1")
                            </div>
                            <div class="rating-stars">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    <i class="fas fa-star @(i <= Math.Round(Model.AverageRating) ? "text-warning" : "text-muted")"></i>
                                }
                            </div>
                            <p class="text-muted">Based on @Model.TotalCount reviews</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="row">
                    @foreach (var feedback in Model.ApprovedFeedback)
                    {
                        <div class="col-lg-6 mb-4">
                            <div class="card h-100 shadow-sm border-0">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-3">
                                        <div class="rating-display">
                                            @for (int i = 1; i <= 5; i++)
                                            {
                                                <i class="fas fa-star @(i <= feedback.Rating ? "text-warning" : "text-muted")"></i>
                                            }
                                        </div>
                                        <small class="text-muted">@feedback.CreatedDate.ToString("MMM yyyy")</small>
                                    </div>
                                    
                                    @if (!string.IsNullOrEmpty(feedback.Comment))
                                    {
                                        <blockquote class="blockquote mb-3">
                                            <p class="mb-0">"@feedback.Comment"</p>
                                        </blockquote>
                                    }
                                    
                                    <div class="border-top pt-3">
                                        <div class="row text-center">
                                            <div class="col-6">
                                                <small class="text-muted d-block">Pet</small>
                                                <strong>@feedback.Appointment?.Pet?.Name</strong>
                                            </div>
                                            <div class="col-6">
                                                <small class="text-muted d-block">Service</small>
                                                <strong>@feedback.Appointment?.Service?.Name</strong>
                                            </div>
                                        </div>
                                        <div class="text-center mt-2">
                                            <small class="text-muted d-block">Doctor</small>
                                            <strong>@feedback.Appointment?.Doctor?.FullName</strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        @if (Model.ApprovedFeedback.Count() > 10)
        {
            <div class="text-center mt-4">
                <p class="text-muted">Showing 10 of @Model.ApprovedFeedback.Count() reviews</p>
            </div>
        }

        <!-- Pagination -->
        @if (Model.TotalPages > 1)
        {
            <div class="row mt-5">
                <div class="col-12">
                    <nav aria-label="Reviews pagination">
                        <ul class="pagination justify-content-center">
                            <!-- Previous button -->
                            <li class="page-item @(Model.CurrentPage <= 1 ? "disabled" : "")">
                                <a class="page-link" href="?pageNumber=@(Model.CurrentPage - 1)" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>

                            <!-- Page numbers -->
                            @{
                                int startPage = Math.Max(1, Model.CurrentPage - 2);
                                int endPage = Math.Min(Model.TotalPages, Model.CurrentPage + 2);
                            }

                            @if (startPage > 1)
                            {
                                <li class="page-item">
                                    <a class="page-link" href="?pageNumber=1">1</a>
                                </li>
                                @if (startPage > 2)
                                {
                                    <li class="page-item disabled">
                                        <span class="page-link">...</span>
                                    </li>
                                }
                            }

                            @for (int i = startPage; i <= endPage; i++)
                            {
                                <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                                    <a class="page-link" href="?pageNumber=@i">@i</a>
                                </li>
                            }

                            @if (endPage < Model.TotalPages)
                            {
                                @if (endPage < Model.TotalPages - 1)
                                {
                                    <li class="page-item disabled">
                                        <span class="page-link">...</span>
                                    </li>
                                }
                                <li class="page-item">
                                    <a class="page-link" href="?pageNumber=@Model.TotalPages">@Model.TotalPages</a>
                                </li>
                            }

                            <!-- Next button -->
                            <li class="page-item @(Model.CurrentPage >= Model.TotalPages ? "disabled" : "")">
                                <a class="page-link" href="?pageNumber=@(Model.CurrentPage + 1)" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        }
    }
    else
    {
        <div class="text-center py-5">
            <i class="fas fa-comments fa-4x text-muted mb-4"></i>
            <h4 class="text-muted">No Reviews Yet</h4>
            <p class="text-muted">Be the first to share your experience with our veterinary services!</p>
            <a href="/appointments/book" class="btn btn-primary mt-3">
                <i class="fas fa-calendar-plus"></i> Book An Appointment
            </a>
        </div>
    }
</div>

@section Styles {
    <style>
        .rating-stars {
            font-size: 1.2rem;
            margin: 10px 0;
        }

        .rating-display i {
            margin: 0 2px;
        }

        .card {
            transition: transform 0.2s ease-in-out;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .blockquote {
            font-style: italic;
            position: relative;
        }

        .blockquote:before {
            content: '"';
            font-size: 2rem;
            color: #dee2e6;
            position: absolute;
            left: -15px;
            top: -5px;
        }

        .blockquote:after {
            content: '"';
            font-size: 2rem;
            color: #dee2e6;
            position: absolute;
            right: -15px;
            bottom: -15px;
        }
    </style>
}
